\documentclass{article}
\usepackage{times}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[russian]{babel}
\usepackage[a4paper, total={6in, 8in}]{geometry}
\usepackage{dirtytalk}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{color,soul}

\graphicspath{ {./img/} }

% code listings settings
\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}

\lstdefinelanguage{JavaScript}{
	keywords={break, case, catch, continue, debugger, default, delete, do, else, false, finally, for, function, if, in, instanceof, new, null, return, switch, this, throw, true, try, typeof, var, void, while, with},
	morecomment=[l]{//},
	morecomment=[s]{/*}{*/},
	morestring=[b]',
	morestring=[b]",
	ndkeywords={class, export, boolean, throw, implements, import, this},
	keywordstyle=\color{blue}\bfseries,
	ndkeywordstyle=\color{darkgray}\bfseries,
	identifierstyle=\color{black},
	commentstyle=\color{purple}\ttfamily,
	stringstyle=\color{red}\ttfamily,
	sensitive=true
}

\lstset{
	language=JavaScript,
	backgroundcolor=\color{lightgray},
	columns=fullflexible,
	basicstyle=\ttfamily,
	extendedchars=false,
	showstringspaces=false,
	showspaces=false,
	numbers=left,
	numberstyle=\footnotesize,
	numbersep=9pt,
	tabsize=2,
	breaklines=true,
	showtabs=false,
	captionpos=b
}


\begin{document}
\title{Лабораторная работа 1}

\date{\today}
\maketitle

\say{Сначала учите науку программирования и всю теорию. Далее выработаете свой программистский стиль. Затем забудьте все и просто программируйте.
— George Carrette}

\section{Введение}

Цель: изучить работу Ethereum, изучить Ganache


\section{Основные понятия}

\begin{itemize}
	\item BlockChain (блокчейн) - выстроенная по определённым правилам непрерывная последовательная цепочка блоков (связный список), содержащих информацию. Чаще всего копии цепочек блоков хранятся на множестве разных компьютеров независимо друг от друга. 
	\item Etheruim (эфир) -  платформа для создания децентрализованных онлайн-сервисов на базе блокчейна
	\item Smart Contract (умный контракт) - компьютерный алгоритм, предназначенный для заключения и поддержания коммерческих контрактов в технологии блокчейн. 
	\item 	
\end{itemize}


Для выполнения лабораторной работы, необходимо восопльзоватся виртуальной машиной, на которой установлена Ubuntu 18.04 и весь необходимый набор ПО.

Теорию можно прочесть в файле Theory.pdf.

(Тут будет инфа о пути к тестовому проекту)


\section{Подготовка окружения}

Все необходимые зависимости уже установлены на виртуальную машину. Далее будут представлены необходимые программы и пакеты для выполнения лабораторной работы. 

\subsection{Ganache}

Ganache - это блокчейн для разработки Ethereum, которую вы можете использовать для развертывания контрактов, разработки приложений и запуска тестов. Он создает виртуальную цепочку Ethereum и генерирует некоторые поддельные учетные записи, которые мы будем использовать во время разработки (Рис. 1).

Для запуска Ganache, найдите значек в меню приложений. Сразу после запука будут установлены значения по умолчанию, контролирующие количество поддельных учетных записей и сумму ETH на их счетах.

\begin{figure}
    \centering
    \includegraphics[scale=0.4]{ganache_1}
    \caption{Интерфейс Ganache.}
    \label{fig:ganache_1}
\end{figure}

\subsection{Metamask}

Metamask -  это криптовалютный кошелек, который встраивается в браузер Google Chrome и он нужен для упрощения передачи Эфира (Эфириум,  Ethereum, ETH)  или токенов ERC-20  в сети Эфириума. Мы будем использовать его для тестирования смарт-контрактов.


\begin{figure}
    \centering
    \includegraphics[scale=0.4]{metamask_1}
    \caption{Интерфейс MetaMask.}
    \label{fig:metamask_1}
\end{figure}


\section{Создание проекта}

Для выполнения лабораторной работы, воспользуемся уже готовым проектом, в нем будут необходимые файлы для фронтенда и т.п. Для скачивания тестового проекта, перейдите в каталог, куда будет скачан проект и выполнить:

(тут будет скрин с командой  truffle unbox pet-shop)

После выполнения данной команды будет скачан проект в виде следующих файлов:

(тут будет скрин дерева проекта)


\begin{itemize}
	\item contracts:  Смарт-контракты. В папке уже есть контракт для миграций в блокчейн.
	\item migrations: Миграции. Эти миграции похожи на используемые в web фромеворках для изменения состояния базы данных.
	\item node modules: зависимости NodeJS.
	\item src: клиентские приложения.
	\item test: папка с тестами.
	\item truffle.js: файл с конфигурацией для truffle
\end{itemize}

\subsection{Создание первого смарт-контракта}
\medskip
Для создания смарт-контракта необходимо создать файл с расширением \hl{.sol} в папке \hl{contracts}. 
Пример:


\begin{lstlisting}[language=JavaScript, caption={contracts/Election.sol}]
pragma solidity 0.4.2;

contract Election {
	// Read/write candidate
	string public candidate;
	
	// Constructor
	function Election () public {
		candidate = "Candidate 1";
	}
}
\end{lstlisting}


Начнем с объявления версии solidity с помощью \hl{pragma}. Затем объявляем смарт-контракт с ключевым словом \hl{contract}, за которым следует название контракта. Затем мы объявляем переменную состояния, которая будет хранить значение имени кандидата. Переменные состояния позволяют нам записывать данные в блокчейн. Мы объявили, что эта переменная будет строкой, и мы установили ее видимость public. Поскольку она является public, solidity генерирует функцию getter, которая позволит получить доступ к этой переменной за пределами контракта.

Затем мы создаем функцию-конструктор, которая будет вызываться при каждом разворачивании смарт-контракта в цепочку. Здесь мы установим значение переменной состояния кандидата, которая будет сохранена в блокчейне после миграции. Обратите внимание, что функция конструктора имеет то же имя, что и смарт-контракт. Так solidity знает, что функция является конструктором.

\bigbreak

Теперь, когда мы создали основу для смарт-контракта, давайте посмотрим, можно ли его развернуть в блокчейн. Для этого нам нужно создать новый файл в каталоге миграции. Из корня проекта создайте новый файл из командной строки следующим образом:

\begin{lstlisting}[language=JavaScript, caption={contracts/Election.sol}]
var Election = artifacts.require("./Election.sol");

	module.exports = function(deployer) {
	deployer.deploy(Election);
};
\end{lstlisting}


\begin{thebibliography}{9}

	\bibitem{lamport94}
	  \emph{Как работает Эфириум (Ethereum)?}
	  https://habr.com/post/407583/

\end{thebibliography}

\end{document}